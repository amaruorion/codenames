<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Codenames 5x5 Grid Encoder</title>
<style>
body { font-family: Arial, sans-serif; margin: 30px; }
input, button { padding: 5px; margin: 5px; }
span { font-size: 24px; line-height: 1.2em; }
pre { font-size: 24px; line-height: 1.2em; }
</style>
</head>
<body>
<h1>Codenames 5x5 Grid Encoder</h1>

<label>Enter coordinates (x,y) separated by spaces, e.g., 0,0 4,0 3,1 0,2 1,2 0,3 2,3 1,4 2,4:</label><br>
<input type="text" id="coordInput" placeholder="0,0 4,0 3,1 0,2 1,2 0,3 2,3 1,4 2,4" size="50"><br>
<button onclick="encodeGrid()">Encode</button>
<p>Encoded Characters: <span id="encodedOutput"></span> <button onclick="copyEncoded()">Copy</button></p>

<label>Enter 2 CJK characters:</label><br>
<input type="text" id="charInput" maxlength="2"><br>
<label>Enter number (8 or 9):</label><br>
<input type="number" id="numberInput" min="0" max="9"><br>
<button onclick="decodeChars()">Decode</button>
<p>Decoded Grid:</p>
<pre id="decodedOutput"></pre>

<script>
const BASE = 4096;
const START = 0x4E00;
const GRID_WIDTH = 5;
const GRID_HEIGHT = 5;
const TOTAL_BITS = GRID_WIDTH * GRID_HEIGHT;
const BLACK = '\u2B1B';
const WHITE = '\u2B1C';

// Map coordinates to first 24 bits, ignore bottom-right
function coordsToBinary(coords) {
    let bits = Array(24).fill('0');
    coords.forEach(([x,y])=>{
        x = Number(x); y = Number(y);
        let index = y*5 + x;
        if(index >=0 && index < 24){
            bits[index]='1';
        }
    });
    return bits.join('');
}

function encodeGrid(){
    let input = document.getElementById('coordInput').value.trim();
    if(!input) { alert('Enter coordinates'); return; }

    let coordPairs = input.split(/\s+/).map(s=>s.split(','));
    for(let i=0;i<coordPairs.length;i++){
        if(coordPairs[i].length!==2 || isNaN(coordPairs[i][0]) || isNaN(coordPairs[i][1])){
            alert('Invalid coordinate: ' + coordPairs[i].join(',')); return;
        }
    }

    let bits = coordsToBinary(coordPairs);
    let value24 = parseInt(bits,2);
    let hi = Math.floor(value24/BASE);
    let lo = value24 % BASE;
    let encodedChars = String.fromCharCode(START+hi)+String.fromCharCode(START+lo);
    document.getElementById('encodedOutput').innerText = encodedChars;
}

function decodeChars(){
    let chars = document.getElementById('charInput').value;
    let number = parseInt(document.getElementById('numberInput').value);
    if(chars.length!==2){ alert('Enter exactly 2 characters'); return; }
    if(isNaN(number)||(number!==8&&number!==9)){ alert('Enter number 8 or 9'); return; }

    let hi = chars.charCodeAt(0)-START;
    let lo = chars.charCodeAt(1)-START;
    let value24 = hi*BASE + lo;
    let bits = value24.toString(2).padStart(24,'0');

    // bottom-right square (index 24) determined by number logic
    let onesCount = (bits.match(/1/g)||[]).length;
    bits += ((onesCount===7 && number===8)||(onesCount===8 && number===9)) ? '1' : '0';

    let grid = '';
    for(let y=0;y<5;y++){
        for(let x=0;x<5;x++){
            let index = y*5 + x;
            grid += (bits[index]==='1'?BLACK:WHITE);
        }
        grid += '\n';
    }
    document.getElementById('decodedOutput').innerText = grid;
}

function copyEncoded(){
    let span = document.getElementById('encodedOutput');
    let text = span.innerText;
    navigator.clipboard.writeText(text).then(()=>{
        alert('Copied: ' + text);
    });
}
</script>
</body>
</html>
