<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Codenames 5x5 Grid Encoder</title>
<style>
body { font-family: Arial, sans-serif; margin: 30px; }
input, button { padding: 5px; margin: 5px; }
span { font-size: 24px; line-height: 1.2em; }
pre { font-size: 24px; line-height: 1.2em; }
</style>
</head>
<body>
<h1>Codenames 5x5 Grid Encoder</h1>

<label>Enter coordinates (x,y) separated by spaces, e.g., 0,0 4,0 3,1 0,2 1,2 0,3 2,3 1,4 2,4:</label><br>
<input type="text" id="coordInput" placeholder="0,0 4,0 3,1 0,2 1,2 0,3 2,3 1,4 2,4" size="50"><br>
<button onclick="encodeGrid()">Encode</button>
<p>Encoded Characters: <span id="encodedOutput"></span> <button onclick="copyEncoded()">Copy</button></p>

<label>Enter 2 CJK characters (from encoding):</label><br>
<input type="text" id="charInput" maxlength="2"><br>
<label>Enter target number of black squares (8 or 9):</label><br>
<input type="number" id="targetNum" min="1" max="25" value="8"><br>
<button onclick="decodeGrid()">Decode</button>
<p>Decoded Grid:</p>
<pre id="decodedOutput"></pre>

<script>
const BASE = 4096;
const START = 0x4E00;
const GRID_WIDTH = 5;
const GRID_HEIGHT = 5;
const BLACK = '\u2B1B';
const WHITE = '\u2B1C';

// Convert coordinates to 24-bit array, ignoring bottom-right
function coordsToBits(coords){
    let bits = Array(24).fill('0');
    coords.forEach(([x,y])=>{
        x = Number(x);
        y = Number(y);
        if(x===4 && y===4) return; // ignore bottom-right
        let index = y*GRID_WIDTH + x;
        if(index >=0 && index < 24){
            bits[index]='1';
        }
    });
    return bits;
}

// Encode coordinates to 2 CJK characters
function encodeGrid(){
    let input = document.getElementById('coordInput').value.trim();
    if(!input){ alert('Enter coordinates'); return; }
    let coordPairs = input.split(/\s+/).map(s=>s.split(','));
    for(let i=0;i<coordPairs.length;i++){
        if(coordPairs[i].length!==2 || isNaN(coordPairs[i][0]) || isNaN(coordPairs[i][1])){
            alert('Invalid coordinate: ' + coordPairs[i].join(',')); return;
        }
    }

    let bits = coordsToBits(coordPairs);

    // little-endian: bit 0 = index 0, bit 23 = index 23
    let value24 = 0;
    for(let i=0;i<24;i++){
        if(bits[i]==='1') value24 += (1<<i);
    }

    let hi = Math.floor(value24 / BASE);
    let lo = value24 % BASE;
    let encodedChars = String.fromCharCode(START+hi) + String.fromCharCode(START+lo);
    document.getElementById('encodedOutput').innerText = encodedChars;

    // Store the number of 1s for decoding
    window.lastCoordCount = coordPairs.length;
}

// Decode 2 CJK characters to 5x5 emoji grid
function decodeGrid(){
    let chars = document.getElementById('charInput').value;
    let targetNum = parseInt(document.getElementById('targetNum').value);
    if(chars.length!==2){ alert('Enter exactly 2 characters'); return; }
    if(isNaN(targetNum) || targetNum<1 || targetNum>25){ alert('Enter a valid target number'); return; }

    let hi = chars.charCodeAt(0)-START;
    let lo = chars.charCodeAt(1)-START;
    let value24 = hi*BASE + lo;

    // Reconstruct 24 bits little-endian
    let bits = [];
    let blackCount = 0;
    for(let i=0;i<24;i++){
        let bit = (value24 & (1<<i)) ? '1' : '0';
        bits.push(bit);
        if(bit==='1') blackCount++;
    }

    // Last square: black if blackCount < targetNum
    let bottomRight = (blackCount < targetNum) ? '1' : '0';
    bits.push(bottomRight);

    // Build 5x5 grid
    let grid='';
    for(let y=0;y<GRID_HEIGHT;y++){
        for(let x=0;x<GRID_WIDTH;x++){
            let index = y*GRID_WIDTH + x;
            grid += (bits[index]==='1'?BLACK:WHITE);
        }
        grid += '\n';
    }
    document.getElementById('decodedOutput').innerText = grid;
}

// Copy encoded characters to clipboard
function copyEncoded(){
    let span = document.getElementById('encodedOutput');
    let text = span.innerText;
    navigator.clipboard.writeText(text).then(()=>{ alert('Copied: ' + text); });
}
</script>
</body>
</html>
